# GitHub Issues for Code Coverage Improvements
#
# Generated: 2025-12-28
# Based on: coverage-analysis-2025-12-28.md
#
# Import: ./scripts/import-issues.sh

issues:
  - title: '[Coverage] WhatsApp Message Routes - Improve branch coverage from 86.66% to 90%+'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Improve branch coverage in `apps/whatsapp-service/src/routes/messageRoutes.ts` from 86.66% to at least 90%.

      ## ⚠️ MANDATORY: Repository Standards

      Before writing ANY code, you MUST:

      1. **Read `.github/copilot-instructions.md`** — all coding standards
      2. **Read `.github/instructions/apps.instructions.md`** — app patterns
      3. **Run Prettier before CI**: `pnpm prettier --write .`
      4. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/whatsapp-service/src/routes/messageRoutes.ts`

      **Current Coverage:** 90.9% lines, 86.66% branches
      **Uncovered Lines:** 116, 228, 318, 434

      ## Required Test Cases

      1. **Invalid message ID format** (line 116)
         - Test: Request with malformed message ID
         - Expected: Validation error response

      2. **User mapping not found** (line 228)
         - Test: Request for user without phone mapping
         - Expected: NOT_FOUND or appropriate error

      3. **Media URL resolution failures** (line 318)
         - Test: Mock media service to fail
         - Expected: Error response with details

      4. **Pagination edge cases** (line 434)
         - Test: Request with invalid cursor
         - Expected: Appropriate error handling

      ## Test File

      `apps/whatsapp-service/src/__tests__/messageRoutes.test.ts`

      ## Acceptance Criteria

      - [ ] All 4 test cases implemented and passing
      - [ ] Branch coverage ≥ 90% for messageRoutes.ts
      - [ ] `pnpm run ci` passes

      ## Coverage Reporting (REQUIRED)

      **Before starting**, run:
      ```bash
      pnpm run test:coverage 2>&1 | grep -A2 "messageRoutes.ts"
      ```

      **After completing**, include BOTH outputs in PR description.

      ## Effort Estimate

      Medium (2-3 hours)

  - title: '[Coverage] WhatsApp Shared Utilities - Improve branch coverage from 93.24% to 100%'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Improve branch coverage in `apps/whatsapp-service/src/routes/shared.ts` from 93.24% to 100%.

      ## ⚠️ MANDATORY: Repository Standards

      Before writing ANY code, you MUST:

      1. **Read `.github/copilot-instructions.md`** — all coding standards
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/whatsapp-service/src/routes/shared.ts`

      **Current Coverage:** 96.03% lines, 93.24% branches
      **Uncovered Lines:** 113, 341, 374, 404

      ## Required Test Cases

      1. **Response builder edge cases** (line 113)
         - Test: Edge case in response construction

      2. **Error mapping completeness** (lines 341, 374)
         - Test: All error types mapped correctly

      3. **Schema validation branches** (line 404)
         - Test: Validation edge cases

      ## Test File

      `apps/whatsapp-service/src/__tests__/shared.test.ts`

      ## Acceptance Criteria

      - [ ] All uncovered branches tested
      - [ ] Branch coverage = 100% for shared.ts
      - [ ] `pnpm run ci` passes

      ## Coverage Reporting (REQUIRED)

      **Before starting**, run:
      ```bash
      pnpm run test:coverage 2>&1 | grep -A2 "shared.ts"
      ```

      ## Effort Estimate

      Low (1 hour)

  - title: '[Coverage] Transcribe Audio - Improve branch coverage from 78.12% to 90%+'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Improve branch coverage in `apps/whatsapp-service/src/domain/inbox/usecases/transcribeAudio.ts` from 78.12% to at least 90%.

      ## ⚠️ MANDATORY: Repository Standards

      Before writing ANY code, you MUST:

      1. **Read `.github/copilot-instructions.md`** — all coding standards
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/whatsapp-service/src/domain/inbox/usecases/transcribeAudio.ts`

      **Current Coverage:** 100% lines, 78.12% branches
      **Uncovered Lines:** 169, 299-349, 419

      ## Required Test Cases

      1. **Transcription timeout handling** (line 169)
         - Test: Mock slow transcription response
         - Expected: Timeout error

      2. **Partial response scenarios** (lines 299-349)
         - Test: Transcription returns incomplete data
         - Expected: Graceful handling

      3. **Retry logic edge cases** (line 419)
         - Test: Transient failures followed by success
         - Expected: Retry executed

      ## Test File

      `apps/whatsapp-service/src/__tests__/usecases/transcribeAudio.test.ts`

      ## Acceptance Criteria

      - [ ] All 3 test cases implemented and passing
      - [ ] Branch coverage ≥ 90% for transcribeAudio.ts
      - [ ] `pnpm run ci` passes

      ## Coverage Reporting (REQUIRED)

      **Before starting**, run:
      ```bash
      pnpm run test:coverage 2>&1 | grep -A2 "transcribeAudio.ts"
      ```

      ## Effort Estimate

      Medium (2 hours)

  - title: '[Coverage] OAuth Routes - Test Auth0 not configured scenario'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Add test for uncovered branch in `apps/user-service/src/routes/oauthRoutes.ts` (lines 95-96).

      ## ⚠️ MANDATORY: Repository Standards

      1. **Read `.github/copilot-instructions.md`**
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/user-service/src/routes/oauthRoutes.ts`

      **Uncovered Lines:** 95-96

      ## Required Test Case

      **Auth0 not configured scenario**
      - Test: Request OAuth token when Auth0 config is null
      - Expected: 400 response with "Auth0 is not configured" error

      ## Test File

      `apps/user-service/src/__tests__/oauthRoutes.test.ts`

      ## Acceptance Criteria

      - [ ] Test case implemented and passing
      - [ ] `pnpm run ci` passes

      ## Effort Estimate

      Low (30 minutes)

  - title: '[Coverage] Status Routes - Test repository error propagation'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Add test for uncovered branch in `apps/mobile-notifications-service/src/routes/statusRoutes.ts` (line 85).

      ## ⚠️ MANDATORY: Repository Standards

      1. **Read `.github/copilot-instructions.md`**
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/mobile-notifications-service/src/routes/statusRoutes.ts`

      **Uncovered Lines:** 85

      ## Required Test Case

      **Repository error propagation**
      - Test: Mock repository to return error
      - Expected: Error response propagated correctly

      ## Test File

      `apps/mobile-notifications-service/src/__tests__/routes.test.ts`

      ## Acceptance Criteria

      - [ ] Test case implemented and passing
      - [ ] `pnpm run ci` passes

      ## Effort Estimate

      Low (30 minutes)

  - title: '[Coverage] WhatsApp Webhook Routes - Test webhook type validation'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Add test for uncovered branch in `apps/whatsapp-service/src/routes/webhookRoutes.ts` (line 177).

      ## ⚠️ MANDATORY: Repository Standards

      1. **Read `.github/copilot-instructions.md`**
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/whatsapp-service/src/routes/webhookRoutes.ts`

      **Uncovered Lines:** 177

      ## Required Test Case

      **Webhook type validation edge case**
      - Test: Send webhook with unexpected type
      - Expected: Graceful handling

      ## Test File

      `apps/whatsapp-service/src/__tests__/webhookReceiver.test.ts`

      ## Acceptance Criteria

      - [ ] Test case implemented and passing
      - [ ] `pnpm run ci` passes

      ## Effort Estimate

      Low (30 minutes)

  - title: '[Coverage] WhatsApp Sender - Test message send error handling'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Add test for uncovered line in `apps/whatsapp-service/src/infra/whatsapp/sender.ts` (line 27).

      ## ⚠️ MANDATORY: Repository Standards

      1. **Read `.github/copilot-instructions.md`**
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/whatsapp-service/src/infra/whatsapp/sender.ts`

      **Uncovered Lines:** 27

      ## Required Test Case

      **Message send error handling**
      - Test: Mock WhatsApp API to return error
      - Expected: Error propagated correctly

      ## Test File

      `apps/whatsapp-service/src/__tests__/infra/sender.test.ts`

      ## Acceptance Criteria

      - [ ] Test case implemented and passing
      - [ ] `pnpm run ci` passes

      ## Effort Estimate

      Low (30 minutes)

  - title: '[Coverage] HTTP Client - Test response parsing error branch'
    labels:
      - testing
      - coverage
      - copilot
    body: |
      ## Objective

      Add test for uncovered branch in `apps/user-service/src/routes/httpClient.ts` (line 43).

      ## ⚠️ MANDATORY: Repository Standards

      1. **Read `.github/copilot-instructions.md`**
      2. **Run Prettier before CI**: `pnpm prettier --write .`
      3. **All verification must pass**: `pnpm run ci`

      ## Target File

      `apps/user-service/src/routes/httpClient.ts`

      **Uncovered Lines:** 43

      ## Required Test Case

      **Response parsing error branch**
      - Test: Mock response with invalid JSON
      - Expected: Error handled gracefully

      ## Test File

      `apps/user-service/src/__tests__/httpClient.test.ts`

      ## Acceptance Criteria

      - [ ] Test case implemented and passing
      - [ ] `pnpm run ci` passes

      ## Effort Estimate

      Low (30 minutes)
