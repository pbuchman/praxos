# Firestore Emulator for Testing
#
# Usage:
#   Start:   docker compose -f docker/firestore/docker-compose.yaml up -d
#   Stop:    docker compose -f docker/firestore/docker-compose.yaml down
#   Logs:    docker compose -f docker/firestore/docker-compose.yaml logs -f
#
# The emulator persists in background for fast test iteration.
# Tests auto-detect running emulator and skip starting their own.

services:
  firestore-emulator:
    image: google/cloud-sdk:emulators
    container_name: praxos-firestore-emulator
    command:
      - gcloud
      - emulators
      - firestore
      - start
      - --host-port=0.0.0.0:8085
      - --project=test-project
    ports:
      - '8085:8085'
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:8085/']
      interval: 5s
      timeout: 3s
      start_period: 10s
      retries: 5
    restart: unless-stopped
