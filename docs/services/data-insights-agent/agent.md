# data-insights-agent — Agent Interface

> Machine-readable interface definition for AI agents interacting with data-insights-agent.

---

## Identity

| Field    | Value                                                                     |
| --------  | -------------------------------------------------------------------------  |
| **Name** | data-insights-agent                                                       |
| **Role** | Data Analytics and Visualization Service                                  |
| **Goal** | Analyze composite data feeds and generate AI-powered insights with charts |

---

## Capabilities

### Tools (Endpoints)

```typescript
interface DataInsightsAgentTools {
  // Data Sources
  createDataSource(params: { title: string; content: string }): Promise<DataSource>;
  listDataSources(): Promise<DataSource[]>;
  getDataSource(id: string): Promise<DataSource>;
  updateDataSource(
    id: string,
    params: {
      title?: string;
      content?: string;
    }
  ): Promise<DataSource>;
  deleteDataSource(id: string): Promise<void>;
  generateTitle(params: { content: string }): Promise<{ title: string }>;

  // Composite Feeds
  createCompositeFeed(params: {
    purpose: string;
    staticSourceIds: string[];
    notificationFilters: NotificationFilter[];
  }): Promise<CompositeFeed>;
  listCompositeFeeds(): Promise<CompositeFeed[]>;
  getCompositeFeed(id: string): Promise<CompositeFeed>;
  updateCompositeFeed(
    id: string,
    params: {
      purpose?: string;
      staticSourceIds?: string[];
      notificationFilters?: NotificationFilter[];
    }
  ): Promise<CompositeFeed>;
  deleteCompositeFeed(id: string): Promise<void>;
  getCompositeFeedSchema(id: string): Promise<JSONSchema>;
  getCompositeFeedData(id: string): Promise<FeedData>;
  getCompositeFeedSnapshot(
    id: string,
    params?: {
      refresh?: boolean;
    }
  ): Promise<Snapshot>;

  // Data Insights
  analyzeCompositeFeed(feedId: string): Promise<AnalysisResult>;
  generateChartDefinition(feedId: string, insightId: string): Promise<ChartDefinition>;
  previewChart(
    feedId: string,
    params: {
      chartConfig: object;
      transformInstructions: string;
      insightId: string;
    }
  ): Promise<ChartData>;
}
```

### Types

```typescript
interface DataSource {
  id: string;
  userId: string;
  title: string;
  content: string;
  createdAt: string;
  updatedAt: string;
}

interface NotificationFilter {
  id: string;
  name: string;
  app?: string[];
  source?: string;
  title?: string;
}

interface CompositeFeed {
  id: string;
  userId: string;
  name: string;
  purpose: string;
  staticSourceIds: string[];
  notificationFilters: NotificationFilter[];
  createdAt: string;
  updatedAt: string;
}

interface Snapshot {
  feedId: string;
  feedName: string;
  purpose: string;
  generatedAt: string;
  expiresAt: string;
  staticSources: SourceData[];
  notifications: NotificationData[];
}

interface DataInsight {
  id: string;
  title: string;
  description: string;
  chartType: 'line' | 'bar' | 'pie' | 'scatter' | 'area';
  metrics: string[];
  dimensions: string[];
}

interface AnalysisResult {
  insights: DataInsight[];
  noInsightsReason?: string;
}

interface ChartDefinition {
  vegaLiteConfig: object; // Vega-Lite spec without data
  dataTransformInstructions: string; // How to transform snapshot data
}

interface ChartData {
  values: Record<string, unknown>[]; // Transformed data for chart
}
```

---

## Constraints

| Rule                    | Description                                  |
| -----------------------  | --------------------------------------------  |
| **Ownership**           | Users can only access their own data         |
| **LLM Keys Required**   | Analysis requires configured Google API key  |
| **Max Insights**        | Analyze returns up to 5 insights per feed    |
| **Snapshot Expiration** | Snapshots cached for 24 hours before refresh |
| **Source Protection**   | Cannot delete source used by composite feeds |

---

## Usage Patterns

### Create Data Source

```typescript
const source = await createDataSource({
  title: 'Q1 Sales Data',
  content: 'JSON or CSV content here...',
});
```

### Create Composite Feed

```typescript
const feed = await createCompositeFeed({
  purpose: 'Track daily sales and inventory alerts',
  staticSourceIds: [salesDataId, inventoryDataId],
  notificationFilters: [
    {
      id: 'alerts',
      name: 'Inventory Alerts',
      app: ['com.inventory.app'],
    },
  ],
});
// Feed name auto-generated by AI based on purpose
```

### Analyze Feed Data

```typescript
const analysis = await analyzeCompositeFeed(feedId);
// analysis.insights contains up to 5 measurable insights
// Each insight suggests a chart type and metrics to track
```

### Generate Chart

```typescript
// Step 1: Get chart definition
const definition = await generateChartDefinition(feedId, insightId);
// definition.vegaLiteConfig: Vega-Lite spec
// definition.dataTransformInstructions: How to prepare data

// Step 2: Get preview data
const chartData = await previewChart(feedId, {
  chartConfig: definition.vegaLiteConfig,
  transformInstructions: definition.dataTransformInstructions,
  insightId,
});
// chartData.values: Ready for Vega-Lite rendering
```

---

## Data Flow

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Data Sources   │────▶│ Composite Feed  │────▶│   Snapshot      │
│  (static data)  │     │ (aggregation)   │     │ (cached view)   │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
┌─────────────────┐     ┌─────────────────┐              │
│  Notifications  │────▶│ Notification    │──────────────┘
│  (from mobile)  │     │ Filters         │
└─────────────────┘     └─────────────────┘

                              │
                              ▼
                    ┌─────────────────┐     ┌─────────────────┐
                    │  AI Analysis    │────▶│ Chart Generation│
                    │  (Gemini)       │     │ (Vega-Lite)     │
                    └─────────────────┘     └─────────────────┘
```

---

## Internal Endpoints

| Method | Path                           | Purpose                            |
| ------  | ------------------------------  | ----------------------------------  |
| GET    | `/internal/feeds/:id/snapshot` | Get snapshot for internal services |

---

## Error Handling

| Error Code             | Description                            |
| ----------------------  | --------------------------------------  |
| `NOT_FOUND`            | Feed, source, or snapshot not found    |
| `CONFLICT`             | Cannot delete source used by feeds     |
| `MISCONFIGURED`        | LLM API key not configured             |
| `ANALYSIS_ERROR`       | AI analysis failed                     |
| `GENERATION_ERROR`     | Chart generation failed                |
| `TRANSFORMATION_ERROR` | Data transformation for preview failed |

---

**Last updated:** 2026-01-19
