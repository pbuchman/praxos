# Progressive Web App (PWA) Setup

IntexuraOS is a Progressive Web App (PWA) that can be installed on mobile devices and desktop browsers for an app-like experience.

## Features

- **Standalone mode**: Runs without browser UI when installed
- **Offline caching**: Static assets are cached for faster loading
- **Auto-updates**: New versions are detected and applied automatically
- **Home screen install**: Can be added to the home screen on Android and iOS

## Adding to Home Screen

### Android (Chrome, Edge, Samsung Internet)

1. Open IntexuraOS in your browser
2. A banner will appear at the bottom: **"Install IntexuraOS"**
3. Tap **Install**
4. The app will be added to your home screen

Alternatively:

1. Open the browser menu (⋮)
2. Tap **"Add to Home Screen"** or **"Install app"**
3. Confirm installation

### iOS (Safari)

1. Open IntexuraOS in **Safari** (required - other browsers don't support PWA installation on iOS)
2. A banner will appear at the bottom with instructions
3. Tap the **Share** button (⬆️) in Safari's toolbar
4. Scroll down and tap **"Add to Home Screen"**
5. Tap **Add** to confirm

> **Note**: On iOS, the PWA must be opened via Safari for the first time to enable home screen installation.

### Desktop (Chrome, Edge)

1. Open IntexuraOS in Chrome or Edge
2. Look for the install icon (⊕) in the address bar
3. Click **Install**

## How Updates Work

IntexuraOS uses a service worker to cache assets and detect updates:

1. **On load**: The app checks for a new service worker version
2. **If update available**: A banner appears at the top: **"A new version is available"**
3. **Tap "Update now"**: The app reloads with the latest version

Updates happen automatically in the background. Users only need to take action when prompted.

### Update Behavior

- **HTML files**: Network-first (always fetch fresh content)
- **JS/CSS assets**: Cache-first (cached assets have version hashes)
- **Images/Fonts**: Cache-first with long TTL
- **API requests**: Never cached (always live data)

## Technical Details

### Manifest

The web app manifest (`manifest.webmanifest`) is generated by vite-plugin-pwa with:

```json
{
  "name": "IntexuraOS",
  "short_name": "IntexuraOS",
  "display": "standalone",
  "theme_color": "#2563eb",
  "background_color": "#f8fafc",
  "start_url": "/",
  "scope": "/"
}
```

### Service Worker

The service worker is powered by Workbox and uses:

- **Precaching**: All build assets are precached
- **Runtime caching**: Configurable strategies per asset type
- **Skip waiting**: Updates activate immediately when user confirms

### Icons

| Size    | File                            | Purpose              |
| ------- | ------------------------------- | -------------------- |
| 192×192 | `/pwa-192x192.png`              | Standard PWA icon    |
| 512×512 | `/pwa-512x512.png`              | Large icon, maskable |
| 180×180 | `/apple-touch-icon-180x180.png` | iOS home screen      |

## Known Limitations

### iOS

- **Safari only**: PWAs can only be installed via Safari on iOS
- **No push notifications**: iOS doesn't support web push for PWAs
- **Limited background sync**: Background operations are restricted
- **No update prompts**: iOS doesn't support `beforeinstallprompt`; users see manual instructions

### Android

- **Browser dependent**: Install prompt behavior varies by browser
- **Permissions**: Some features may require additional permissions

### General

- **HTTPS required**: PWAs only work over HTTPS (or localhost)
- **Single origin**: The PWA can only cache assets from its own origin
- **Cache limits**: Browser may evict cached data under storage pressure

## Development

### Testing PWA locally

PWA features are disabled in development mode to avoid caching issues. To test:

1. Build the app: `npm run build`
2. Preview: `npm run preview`
3. Open `http://localhost:3000`

### Debugging

- **Chrome DevTools**: Application → Service Workers
- **Check manifest**: Application → Manifest
- **Inspect cache**: Application → Cache Storage

### Regenerating Icons

If you update the favicon, regenerate PWA icons:

```bash
cd apps/web/public
sips -z 192 192 favicon.png --out pwa-192x192.png
sips -z 512 512 favicon.png --out pwa-512x512.png
sips -z 180 180 favicon.png --out apple-touch-icon-180x180.png
```

## Files

```
apps/web/
├── public/
│   ├── pwa-192x192.png          # PWA icon 192x192
│   ├── pwa-512x512.png          # PWA icon 512x512
│   └── apple-touch-icon-180x180.png  # iOS touch icon
├── src/
│   ├── components/
│   │   └── pwa-banners.tsx      # Install and update UI
│   ├── context/
│   │   └── pwa-context.tsx      # PWA state management
│   └── vite-env.d.ts            # PWA type declarations
├── index.html                    # Meta tags for PWA/iOS
└── vite.config.ts               # PWA plugin configuration
```
